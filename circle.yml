dependencies:
  post:
    - sudo service docker start
    - docker build -t $CIRCLE_USERNAME/em-builder docker
    - docker run --rm -it -v `pwd`:/home/xclient/electron-mattermost $CIRCLE_USERNAME/em-builder ./electron-mattermost/docker/package_in_docker.sh
    - mv release/electron-mattermost-win32-ia32 release/electron-mattermost-win32
    - mv release/electron-mattermost-win32-x64  release/electron-mattermost-win64
    - mv release/electron-mattermost-darwin-x64 release/electron-mattermost-osx
    - cd release && zip -9 -r $CIRCLE_ARTIFACTS/electron-mattermost-win32.zip electron-mattermost-win32
    - cd release && zip -9 -r $CIRCLE_ARTIFACTS/electron-mattermost-win64.zip electron-mattermost-win64
    - tar zcvf $CIRCLE_ARTIFACTS/electron-mattermost-osx.tar.gz -C release electron-mattermost-osx
    - tar zcvf $CIRCLE_ARTIFACTS/electron-mattermost-linux-ia32.tar.gz -C release electron-mattermost-linux-ia32
    - tar zcvf $CIRCLE_ARTIFACTS/electron-mattermost-linux-x64.tar.gz -C release electron-mattermost-linux-x64

test:
  override:
    - exit 0

deployment:
  release:
    tag: /v[0-9]+(\.[0-9]+)*/
    commands:
      - ./circle/make_draft.sh
